(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function s(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(t){if(t.ep)return;t.ep=!0;const o=s(t);fetch(t.href,o)}})();const r="popup_open",u="body_fixed";class l{constructor(){this.popupNode=document.querySelector(".js-popup"),this.popupContentNode=document.querySelector(".js-popup__content"),this.btnOpenNode=document.querySelector(".limit__button"),this.btnCloseNode=document.querySelector(".js-popup__close-btn"),this.bodyNode=document.querySelector("body"),this.btnOpenNode.addEventListener("click",this.togglePopup.bind(this)),this.btnCloseNode.addEventListener("click",this.togglePopup.bind(this)),this.popupNode.addEventListener("click",e=>{!e.composedPath().includes(this.popupContentNode)&&this.togglePopup()})}togglePopup(){this.popupNode.classList.toggle(r),this.bodyNode.classList.toggle(u),this.popupNode.classList.contains(r)&&setTimeout(()=>{this.popupNode.querySelector("input").focus()},100)}}class d{constructor(e){this.container=document.querySelector(e),this.limitTextNode=document.querySelector(".text_limit"),this.calcTextNode=document.querySelector(".text_calc"),this.statusTextNode=document.querySelector(".text_status"),this.inputNode=this.container.querySelector(".control_input"),this.selectNode=this.container.querySelector(".control_select"),this.storyListNode=this.container.querySelector(".story__list"),this.expenseLabel=this.container.querySelector(".text_label"),this.addExpenseButton=this.container.querySelector("#addExpenseButton"),this.resetExpenseButton=this.container.querySelector("#resetExpenseButton"),this.init()}init(){this.count=1,this.inputNode.addEventListener("focus",()=>this.onInputFocus()),this.inputNode.addEventListener("blur",e=>this.onInputBlur(e)),this.addExpenseButton.addEventListener("click",e=>this.addExpense(e)),this.resetExpenseButton.addEventListener("click",()=>this.resetExpense()),this.selectNode.addEventListener("change",e=>this.onSelectChange(e))}addExpense(e){e.preventDefault();const s=this.inputNode.value,i=this.selectNode.value,t=[this.inputNode,this.selectNode];if(!this.checkEmptyFields(t))if(+s>0){const n=document.createElement("li");this.calcValue(s),this.setStatus(),n.classList.add("text"),n.textContent=`${this.count}. ${s} руб. - ${i}`,this.storyListNode.appendChild(n),this.inputNode.value="",this.count++}else this.setErrorOnField(this.inputNode)}resetExpense(){this.storyListNode.innerHTML="",this.calcTextNode.innerHTML=0}checkEmptyFields(e){return e.some(s=>{if(s.value.trim())this.removeErrorOnField(s);else return this.setErrorOnField(s),!0})}onInputFocus(){this.expenseLabel.classList.add("active")}onInputBlur(e){e.target.value?this.expenseLabel.classList.add("active"):this.expenseLabel.classList.remove("active")}onSelectChange(e){e.target.classList.add("active")}setErrorOnField(e){e.classList.add("error")}removeErrorOnField(e){e.classList.remove("error")}calcValue(e){const i=+this.calcTextNode.innerText+ +e;this.calcTextNode.innerText=i}setStatus(){const e=+this.calcTextNode.innerText,s=+this.limitTextNode.innerText,i=e*100/s,t=s-e;this.statusTextNode.classList.remove(...this.statusTextNode.classList),this.statusTextNode.classList.add("text"),this.statusTextNode.classList.add("text_status"),console.log(i),i<80&&(this.statusTextNode.innerText="все хорошо",this.statusTextNode.classList.add("great")),i>=80&&i<100&&(this.statusTextNode.innerText="все нормально",this.statusTextNode.classList.add("good")),i>=100&&(this.statusTextNode.innerText=`все плохо (${t})`,this.statusTextNode.classList.add("bad"))}}class a extends d{constructor(e){super(e),this.popup=new l}init(){this.inputNode.addEventListener("focus",()=>this.onInputFocus()),this.inputNode.addEventListener("blur",e=>this.onInputBlur(e)),this.addExpenseButton.addEventListener("click",e=>this.addExpense(e))}addExpense(e){e.preventDefault();const s=this.inputNode.value,i=[this.inputNode];this.checkEmptyFields(i)||(+s>0?(this.limitTextNode.innerHTML=+s,this.setStatus(),this.popup.togglePopup(),this.inputNode.value=""):this.setErrorOnField(this.inputNode))}}new d("body");new a(".js-popup");
